/**
 * Application:  jQuery.roboForm
 * Version:      1.1.1
 * Release date: 2015-08-21
 * Author:       Stepan Maslennikov (http://csscode.ru)
 * Homepage:     https://github.com/StepanMas/jQuery.roboForm
 * License:      MIT
*/

!function(a){a.roboForm=function(b){var c={formCls:".roboForm",field:":input[data-roborules]:visible",errorElement:".roboForm_error",errorVisible:".roboForm_show",mess_noRequired:"Заполните поле",mess_noEmail:"Укажите почту правильно",mess_noPhone:"Укажите номер правильно",mess_noPattern:"Заполните поле правильно",mess_noInteger:"Можно вводить только целое число",mess_noFloat:"Можно вводить только целое число или число с плавающей точкой",mess_noCyrillic:"Допускаются только символы кириллицы, цифры и символы -_.,?!",mess_range:"Укажите $1 цифр",isNotification:!0,isNotificationAjaxError:!1,isMyNoty:a.isFunction(a.miniNoty)},d=a(document);c.errorElementClass=c.errorElement.replace(".",""),c.errorVisibleClass=c.errorVisible.replace(".","");var b=a.extend(c,b);d.on("submit",b.formCls,function(){var c=a(this),d=!0;return a(b.field,this).each(function(){var c=a(this),g=c.next(),h=a.trim(c.val()),i=c.data("roborules");if(c.removeClass(b.errorElementClass),g.length&&g.hasClass(b.errorVisibleClass)&&g.removeClass(b.errorVisibleClass),f("required",i)&&""===h&&(d=e(c,b.mess_noRequired)),f("email",i)&&(f("required",i)||""!==h)){var j=/^([a-z0-9_\-]+\.)*[a-z0-9_\-]+@([a-z0-9][a-z0-9\-]*[a-z0-9]\.)+[a-z]{2,4}$/i;j.test(h)||(d=e(c,b.mess_noEmail))}if(f("phone",i)&&(f("required",i)||""!==h)&&(/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/.test(h)||(d=e(c,b.mess_noPhone))),f("integer",i)&&(f("required",i)||""!==h)&&(/^\d+$/.test(h)||(d=e(c,b.mess_noInteger))),f("float",i)&&(f("required",i)||""!==h)&&(/^(\d|\.)+$/.test(h)||(d=e(c,b.mess_noFloat))),f("cyrillic",i)&&(f("required",i)||""!==h)&&(/^[а-яё\d\s-_.,\?!]+$/i.test(h)||(d=e(c,b.mess_noCyrillic))),f("range",i)&&(f("required",i)||""!==h)){var k=c.data("range").toString();-1!==k.indexOf("-")?(k=k.split("-"),(h.length<parseInt(k[0])||h.length>parseInt(k[1]))&&(d=e(c,b.mess_range.replace("$1",c.data("range"))))):h.length!==parseInt(k)&&(d=e(c,b.mess_range.replace("$1",c.data("range"))))}if(f("pattern",i)&&(f("required",i)||""!==h)){var j=new RegExp(c.data("robopattern"));j.test(h)||(d=e(c,b.mess_noPattern))}}),d?(c.trigger({type:"roboForm.valid.true"}),a(this).data("ajax")?(a.ajax({type:a(this).attr("method")||"POST",data:a(this).serialize(),url:a(this).attr("action"),success:function(d){try{d=a.parseJSON(d)}catch(e){console.log(e)}if(b.isNotification)try{d.success?b.isMyNoty?a.miniNoty(d.success,"success"):alert(d.success):d.error&&(b.isMyNoty?a.miniNoty(d.error,"error"):alert(d.error))}catch(e){console.error(e,"jQuery.roboForm expects an JSON array")}c.trigger({type:"roboForm.ajax.success",response:d})},error:function(c){if(b.isNotificationAjaxError){var d=c.status+": "+c.statusText;b.isMyNoty?a.miniNoty(d,"error"):alert(d)}}}),!1):void 0):(c.trigger({type:"roboForm.valid.false"}),!1)}),d.on("click",b.errorElement,function(){a(this).removeClass(c.errorVisibleClass).prev().removeClass(c.errorElementClass)}),d.on("focus",b.field,function(){a(this).removeClass(c.errorElementClass).next().removeClass(c.errorVisibleClass)});var e=function(c,d){a('input[type="submit"], .createEvent[data-event="submit"]').removeClass("loader"),c.data("robomessage")&&(d=c.data("robomessage")),c.addClass(b.errorElementClass),console.error(d,c);var e=c.next();if(e.length&&e.hasClass(b.errorElementClass))e.html(d);else{var e=document.createElement("div");e.setAttribute("class",b.errorElementClass),e.innerHTML=d,c.after(e)}return b.isValid=!1,a(e).addClass(b.errorVisibleClass),!1},f=function(a,b){return void 0!==b&&-1!==b.indexOf(a)?!0:!1}}}(jQuery);